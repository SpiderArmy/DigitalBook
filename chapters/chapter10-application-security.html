<!DOCTYPE html>
<html>
<head>
<title>chapter10-application-security.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="chapter-10-application-security">Chapter 10: Application Security</h1>
<h2 id="%F0%9F%8E%AF-learning-objectives">üéØ Learning Objectives</h2>
<p>By the end of this chapter, you will be able to:</p>
<ul>
<li>Understand the principles of secure software development</li>
<li>Identify and mitigate OWASP Top 10 web application vulnerabilities</li>
<li>Implement SAST and DAST tools in CI/CD pipelines</li>
<li>Apply secure coding practices and input validation</li>
<li>Understand API security and authentication mechanisms</li>
<li>Implement secure session management and access controls</li>
<li>Conduct application security testing and code reviews</li>
<li>Apply the Secure Software Development Lifecycle (SSDLC)</li>
</ul>
<h2 id="%F0%9F%9B%A1%EF%B8%8F-what-is-application-security">üõ°Ô∏è What is Application Security?</h2>
<p>Application security encompasses the measures and practices used to protect software applications from security threats and vulnerabilities throughout their lifecycle.</p>
<h3 id="the-application-security-challenge">The Application Security Challenge</h3>
<p>Modern applications face numerous security challenges:</p>
<ul>
<li><strong>Complex Architectures</strong>: Microservices, APIs, and distributed systems</li>
<li><strong>Rapid Development</strong>: Agile methodologies and continuous deployment</li>
<li><strong>Diverse Technologies</strong>: Multiple programming languages and frameworks</li>
<li><strong>External Dependencies</strong>: Third-party libraries and components</li>
<li><strong>User Input</strong>: Uncontrolled data from various sources</li>
</ul>
<h3 id="why-application-security-matters">Why Application Security Matters</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TD
    A[Application Security Benefits] --> B[Data Protection]
    A --> C[Business Continuity]
    A --> D[Compliance]
    A --> E[Customer Trust]
    A --> F[Cost Reduction]
    
    B --> B1[Prevent data breaches]
    B --> B2[Protect user privacy]
    B --> B3[Secure transactions]
    
    C --> C1[Maintain operations]
    C --> C2[Prevent downtime]
    C --> C3[Protect revenue]
    
    D --> D1[Meet regulations]
    D --> D2[Industry standards]
    D --> D3[Audit compliance]
    
    E --> E1[Build confidence]
    E --> E2[Protect reputation]
    E --> E3[Competitive advantage]
    
    F --> F1[Reduce incident costs]
    F --> F2[Lower remediation]
    F --> F3[Prevent legal issues]
    
    style A fill:#e3f2fd
    style B fill:#f3e5f5
    style C fill:#e8f5e8
    style D fill:#fff3e0
    style E fill:#fce4ec
    style F fill:#f1f8e9
</div></code></pre>
<h2 id="%F0%9F%94%92-secure-software-development-lifecycle-ssdlc">üîí Secure Software Development Lifecycle (SSDLC)</h2>
<p>The Secure Software Development Lifecycle integrates security practices into every phase of software development.</p>
<h3 id="ssdlc-phases">SSDLC Phases</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TD
    A[Secure SDLC] --> B[Requirements]
    A --> C[Design]
    A --> D[Implementation]
    A --> E[Testing]
    A --> F[Deployment]
    A --> G[Maintenance]
    
    B --> B1[Security requirements]
    B --> B2[Threat modeling]
    B --> B3[Risk assessment]
    
    C --> C1[Security architecture]
    C --> C2[Design reviews]
    C --> C3[Security patterns]
    
    D --> D1[Secure coding]
    D --> D2[Code reviews]
    D --> D3[Static analysis]
    
    E --> E1[Security testing]
    E --> E2[Penetration testing]
    E --> E3[Vulnerability assessment]
    
    F --> F1[Secure deployment]
    F --> F2[Configuration management]
    F --> F3[Environment security]
    
    G --> G1[Security monitoring]
    G --> G2[Patch management]
    G --> G3[Incident response]
    
    style A fill:#e3f2fd
    style B fill:#f3e5f5
    style C fill:#e8f5e8
    style D fill:#fff3e0
    style E fill:#fce4ec
    style F fill:#f1f8e9
    style G fill:#fff8e1
</div></code></pre>
<h3 id="phase-1-requirements-and-planning">Phase 1: Requirements and Planning</h3>
<h4 id="1-security-requirements">1. <strong>Security Requirements</strong></h4>
<ul>
<li><strong>Functional Security</strong>: Authentication, authorization, encryption</li>
<li><strong>Non-Functional Security</strong>: Performance, availability, compliance</li>
<li><strong>Compliance Requirements</strong>: GDPR, HIPAA, PCI DSS, SOX</li>
<li><strong>Industry Standards</strong>: OWASP, NIST, ISO 27001</li>
</ul>
<h4 id="2-threat-modeling">2. <strong>Threat Modeling</strong></h4>
<p><strong>Purpose</strong>: Identify and analyze potential security threats.</p>
<p><strong>Methodologies</strong>:</p>
<ul>
<li><strong>STRIDE</strong>: Spoofing, Tampering, Repudiation, Information Disclosure, Denial of Service, Elevation of Privilege</li>
<li><strong>PASTA</strong>: Process for Attack Simulation and Threat Analysis</li>
<li><strong>VAST</strong>: Visual, Agile, and Simple Threat modeling</li>
</ul>
<p><strong>Threat Model Example</strong>:</p>
<pre><code class="language-mermaid"><div class="mermaid">graph TD
    A[Web Application] --> B[User Authentication]
    A --> C[Data Processing]
    A --> D[Database Access]
    
    B --> B1[Brute force attacks]
    B --> B2[Session hijacking]
    B --> B3[Credential stuffing]
    
    C --> C1[Input validation]
    C --> C2[Code injection]
    C --> C3[Cross-site scripting]
    
    D --> D1[SQL injection]
    D --> D2[Unauthorized access]
    D --> D3[Data exfiltration]
    
    style A fill:#e3f2fd
    style B fill:#f3e5f5
    style C fill:#e8f5e8
    style D fill:#fff3e0
</div></code></pre>
<h3 id="phase-2-secure-design">Phase 2: Secure Design</h3>
<h4 id="1-security-architecture-principles">1. <strong>Security Architecture Principles</strong></h4>
<ul>
<li><strong>Defense in Depth</strong>: Multiple security layers</li>
<li><strong>Principle of Least Privilege</strong>: Minimal access rights</li>
<li><strong>Fail-Safe Defaults</strong>: Secure by default</li>
<li><strong>Separation of Concerns</strong>: Modular security design</li>
<li><strong>Economy of Mechanism</strong>: Simple security solutions</li>
</ul>
<h4 id="2-security-design-patterns">2. <strong>Security Design Patterns</strong></h4>
<ul>
<li><strong>Authentication Patterns</strong>: Multi-factor, single sign-on, federated</li>
<li><strong>Authorization Patterns</strong>: Role-based, attribute-based, policy-based</li>
<li><strong>Data Protection Patterns</strong>: Encryption, hashing, tokenization</li>
<li><strong>Session Management Patterns</strong>: Secure session handling, timeout, invalidation</li>
</ul>
<h3 id="phase-3-secure-implementation">Phase 3: Secure Implementation</h3>
<h4 id="1-secure-coding-practices">1. <strong>Secure Coding Practices</strong></h4>
<ul>
<li><strong>Input Validation</strong>: Validate and sanitize all inputs</li>
<li><strong>Output Encoding</strong>: Prevent injection attacks</li>
<li><strong>Error Handling</strong>: Secure error messages and logging</li>
<li><strong>Memory Management</strong>: Prevent buffer overflows and memory leaks</li>
</ul>
<h4 id="2-code-review-process">2. <strong>Code Review Process</strong></h4>
<ul>
<li><strong>Automated Tools</strong>: Static analysis and linting</li>
<li><strong>Manual Review</strong>: Peer code review with security focus</li>
<li><strong>Checklists</strong>: Security coding standards and guidelines</li>
<li><strong>Training</strong>: Regular security awareness and skill development</li>
</ul>
<h2 id="%F0%9F%9A%A8-owasp-top-10-web-application-vulnerabilities">üö® OWASP Top 10 Web Application Vulnerabilities</h2>
<p>The OWASP Top 10 represents the most critical web application security risks.</p>
<h3 id="owasp-top-10-2021">OWASP Top 10 2021</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TD
    A[OWASP Top 10 2021] --> B[A01:2021 - Broken Access Control]
    A --> C[A02:2021 - Cryptographic Failures]
    A --> D[A03:2021 - Injection]
    A --> E[A04:2021 - Insecure Design]
    A --> F[A05:2021 - Security Misconfiguration]
    A --> G[A06:2021 - Vulnerable Components]
    A --> H[A07:2021 - Authentication Failures]
    A --> I[A08:2021 - Software and Data Integrity Failures]
    A --> J[A09:2021 - Security Logging Failures]
    A --> K[A10:2021 - Server-Side Request Forgery]
    
    B --> B1[Horizontal privilege escalation]
    B --> B2[Vertical privilege escalation]
    B --> B3[Unauthorized access]
    
    C --> C1[Weak encryption]
    C --> C2[Insecure key management]
    C --> C3[Cryptographic vulnerabilities]
    
    D --> D1[SQL injection]
    D --> D2[NoSQL injection]
    D --> D3[Command injection]
    
    E --> E1[Design flaws]
    E --> E2[Architecture weaknesses]
    E --> E3[Missing security controls]
    
    F --> F1[Default configurations]
    F --> F2[Unnecessary features]
    F --> F3[Insecure settings]
    
    G --> G1[Outdated components]
    G --> G2[Known vulnerabilities]
    G --> G3[Unsupported software]
    
    H --> H1[Weak authentication]
    H --> H2[Session management]
    H --> H3[Credential stuffing]
    
    I --> I1[Supply chain attacks]
    I --> I2[Code tampering]
    I --> I3[Data integrity]
    
    J --> J1[Insufficient logging]
    J --> J2[Log injection]
    J --> J3[Audit trail gaps]
    
    K --> K1[Internal service access]
    K --> K2[Cloud metadata access]
    K --> K3[Network reconnaissance]
    
    style A fill:#e3f2fd
    style B fill:#f3e5f5
    style C fill:#e8f5e8
    style D fill:#fff3e0
    style E fill:#fce4ec
    style F fill:#f1f8e9
    style G fill:#fff8e1
    style H fill:#f3e5f5
    style I fill:#e8f5e8
    style J fill:#fff3e0
    style K fill:#fce4ec
</div></code></pre>
<h3 id="critical-vulnerabilities-and-mitigations">Critical Vulnerabilities and Mitigations</h3>
<h4 id="1-a012021---broken-access-control">1. <strong>A01:2021 - Broken Access Control</strong></h4>
<p><strong>Description</strong>: Restrictions on what authenticated users can access are not properly enforced.</p>
<p><strong>Examples</strong>:</p>
<ul>
<li><strong>Horizontal Privilege Escalation</strong>: Accessing other users' data</li>
<li><strong>Vertical Privilege Escalation</strong>: Gaining administrative privileges</li>
<li><strong>Direct Object References</strong>: Accessing unauthorized resources</li>
</ul>
<p><strong>Mitigation</strong>:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># Secure access control example</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_user_data</span><span class="hljs-params">(user_id, current_user)</span>:</span>
    <span class="hljs-comment"># Check if user can access this data</span>
    <span class="hljs-keyword">if</span> current_user.id != user_id <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> current_user.is_admin:
        <span class="hljs-keyword">raise</span> AccessDenied(<span class="hljs-string">"Unauthorized access"</span>)
    
    <span class="hljs-keyword">return</span> User.objects.get(id=user_id)
</div></code></pre>
<h4 id="2-a022021---cryptographic-failures">2. <strong>A02:2021 - Cryptographic Failures</strong></h4>
<p><strong>Description</strong>: Failures related to cryptography which often lead to sensitive data exposure.</p>
<p><strong>Examples</strong>:</p>
<ul>
<li><strong>Weak Encryption</strong>: Using outdated algorithms</li>
<li><strong>Key Management</strong>: Poor key storage and rotation</li>
<li><strong>Data in Transit</strong>: Unencrypted communications</li>
</ul>
<p><strong>Mitigation</strong>:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># Secure encryption example</span>
<span class="hljs-keyword">from</span> cryptography.fernet <span class="hljs-keyword">import</span> Fernet
<span class="hljs-keyword">import</span> os

<span class="hljs-comment"># Generate secure key</span>
key = Fernet.generate_key()
cipher = Fernet(key)

<span class="hljs-comment"># Encrypt sensitive data</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encrypt_data</span><span class="hljs-params">(data)</span>:</span>
    <span class="hljs-keyword">return</span> cipher.encrypt(data.encode())

<span class="hljs-comment"># Decrypt data</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decrypt_data</span><span class="hljs-params">(encrypted_data)</span>:</span>
    <span class="hljs-keyword">return</span> cipher.decrypt(encrypted_data).decode()
</div></code></pre>
<h4 id="3-a032021---injection">3. <strong>A03:2021 - Injection</strong></h4>
<p><strong>Description</strong>: Untrusted data is sent to an interpreter as part of a command or query.</p>
<p><strong>Types</strong>:</p>
<ul>
<li><strong>SQL Injection</strong>: Database query manipulation</li>
<li><strong>NoSQL Injection</strong>: Document database attacks</li>
<li><strong>Command Injection</strong>: System command execution</li>
<li><strong>LDAP Injection</strong>: Directory service attacks</li>
</ul>
<p><strong>Mitigation</strong>:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># SQL injection prevention with parameterized queries</span>
<span class="hljs-keyword">import</span> sqlite3

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_user_safe</span><span class="hljs-params">(username)</span>:</span>
    conn = sqlite3.connect(<span class="hljs-string">'database.db'</span>)
    cursor = conn.cursor()
    
    <span class="hljs-comment"># Use parameterized query</span>
    cursor.execute(<span class="hljs-string">"SELECT * FROM users WHERE username = ?"</span>, (username,))
    <span class="hljs-keyword">return</span> cursor.fetchone()

<span class="hljs-comment"># Instead of vulnerable string concatenation:</span>
<span class="hljs-comment"># cursor.execute("SELECT * FROM users WHERE username = '" + username + "'")</span>
</div></code></pre>
<h4 id="4-a042021---insecure-design">4. <strong>A04:2021 - Insecure Design</strong></h4>
<p><strong>Description</strong>: Flaws in design and architecture that cannot be fixed by proper implementation.</p>
<p><strong>Examples</strong>:</p>
<ul>
<li><strong>Missing Security Controls</strong>: No authentication or authorization</li>
<li><strong>Weak Architecture</strong>: Single points of failure</li>
<li><strong>Insecure Defaults</strong>: Permissive default configurations</li>
</ul>
<p><strong>Mitigation</strong>:</p>
<ul>
<li><strong>Security by Design</strong>: Integrate security from the start</li>
<li><strong>Threat Modeling</strong>: Identify and address design risks</li>
<li><strong>Security Patterns</strong>: Use proven security architectures</li>
<li><strong>Code Reviews</strong>: Regular security-focused reviews</li>
</ul>
<h4 id="5-a052021---security-misconfiguration">5. <strong>A05:2021 - Security Misconfiguration</strong></h4>
<p><strong>Description</strong>: Incorrectly configured security settings in applications, frameworks, and servers.</p>
<p><strong>Examples</strong>:</p>
<ul>
<li><strong>Default Credentials</strong>: Unchanged default passwords</li>
<li><strong>Unnecessary Features</strong>: Enabled debugging or admin interfaces</li>
<li><strong>Weak Headers</strong>: Missing security headers</li>
<li><strong>Open Permissions</strong>: Overly permissive file permissions</li>
</ul>
<p><strong>Mitigation</strong>:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># Security headers example (Flask)</span>
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask
<span class="hljs-keyword">from</span> flask_talisman <span class="hljs-keyword">import</span> Talisman

app = Flask(__name__)

<span class="hljs-comment"># Configure security headers</span>
Talisman(app, 
    content_security_policy={
        <span class="hljs-string">'default-src'</span>: <span class="hljs-string">"'self'"</span>,
        <span class="hljs-string">'script-src'</span>: <span class="hljs-string">"'self' 'unsafe-inline'"</span>,
        <span class="hljs-string">'style-src'</span>: <span class="hljs-string">"'self' 'unsafe-inline'"</span>
    },
    force_https=<span class="hljs-literal">True</span>
)
</div></code></pre>
<h2 id="%F0%9F%94%8D-security-testing-methodologies">üîç Security Testing Methodologies</h2>
<h3 id="types-of-security-testing">Types of Security Testing</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TD
    A[Security Testing Types] --> B[Static Analysis]
    A --> C[Dynamic Analysis]
    A --> D[Interactive Testing]
    A --> E[Manual Testing]
    
    B --> B1[SAST - Source code analysis]
    B --> B2[Binary analysis]
    B --> B3[Dependency scanning]
    
    C --> C1[DAST - Runtime testing]
    C --> C2[API testing]
    C --> C3[Network scanning]
    
    D --> D1[IAST - Runtime instrumentation]
    D --> D2[Real-time analysis]
    D --> D3[Context-aware testing]
    
    E --> E1[Code review]
    E --> E2[Penetration testing]
    E --> E3[Security audit]
    
    style A fill:#e3f2fd
    style B fill:#f3e5f5
    style C fill:#e8f5e8
    style D fill:#fff3e0
    style E fill:#fce4ec
</div></code></pre>
<h3 id="1-static-application-security-testing-sast">1. <strong>Static Application Security Testing (SAST)</strong></h3>
<p>SAST analyzes source code, bytecode, or binary code without executing the application.</p>
<h4 id="sast-tools">SAST Tools</h4>
<ul>
<li><strong>SonarQube</strong>: Multi-language code quality and security</li>
<li><strong>Checkmarx</strong>: Source code analysis platform</li>
<li><strong>Veracode</strong>: Static analysis and security testing</li>
<li><strong>Semgrep</strong>: Fast, lightweight static analysis</li>
</ul>
<h4 id="sast-implementation">SAST Implementation</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># GitHub Actions SAST example</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">Security</span> <span class="hljs-string">Scan</span>
<span class="hljs-attr">on:</span> <span class="hljs-string">[push,</span> <span class="hljs-string">pull_request]</span>

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">security:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v2</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">Semgrep</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">returntocorp/semgrep-action@v1</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">config:</span> <span class="hljs-string">"p/security-audit"</span>
          
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">Bandit</span> <span class="hljs-string">(Python)</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          pip install bandit
          bandit -r . -f json -o bandit-report.json
</span>          
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Upload</span> <span class="hljs-string">results</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/upload-artifact@v2</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">name:</span> <span class="hljs-string">security-scan-results</span>
          <span class="hljs-attr">path:</span> <span class="hljs-string">|
            semgrep-report.json
            bandit-report.json
</span></div></code></pre>
<h3 id="2-dynamic-application-security-testing-dast">2. <strong>Dynamic Application Security Testing (DAST)</strong></h3>
<p>DAST tests running applications to identify runtime vulnerabilities.</p>
<h4 id="dast-tools">DAST Tools</h4>
<ul>
<li><strong>OWASP ZAP</strong>: Open-source web application scanner</li>
<li><strong>Burp Suite</strong>: Professional web application testing</li>
<li><strong>Acunetix</strong>: Automated vulnerability scanner</li>
<li><strong>AppScan</strong>: IBM security testing platform</li>
</ul>
<h4 id="dast-implementation">DAST Implementation</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># DAST scanning in CI/CD</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">OWASP</span> <span class="hljs-string">ZAP</span> <span class="hljs-string">Scan</span>
  <span class="hljs-attr">run:</span> <span class="hljs-string">|
    # Start ZAP daemon
    zap.sh -daemon -port 8080 -host 0.0.0.0
</span>    
    <span class="hljs-comment"># Run baseline scan</span>
    <span class="hljs-string">zap-baseline.py</span> <span class="hljs-string">-t</span> <span class="hljs-string">http://localhost:3000</span> <span class="hljs-string">-J</span> <span class="hljs-string">zap-report.json</span>
    
    <span class="hljs-comment"># Generate HTML report</span>
    <span class="hljs-string">zap-cli</span> <span class="hljs-string">report</span> <span class="hljs-string">-o</span> <span class="hljs-string">zap-report.html</span> <span class="hljs-string">-f</span> <span class="hljs-string">html</span>
</div></code></pre>
<h3 id="3-interactive-application-security-testing-iast">3. <strong>Interactive Application Security Testing (IAST)</strong></h3>
<p>IAST combines static and dynamic analysis by instrumenting running applications.</p>
<h4 id="iast-benefits">IAST Benefits</h4>
<ul>
<li><strong>Real-time Analysis</strong>: Immediate vulnerability detection</li>
<li><strong>Context Awareness</strong>: Understanding of application flow</li>
<li><strong>Low False Positives</strong>: Accurate vulnerability identification</li>
<li><strong>Integration</strong>: Works with existing development tools</li>
</ul>
<h4 id="iast-tools">IAST Tools</h4>
<ul>
<li><strong>Contrast Security</strong>: Runtime application security</li>
<li><strong>Hdiv</strong>: Interactive security testing</li>
<li><strong>Seeker</strong>: IAST security testing platform</li>
</ul>
<h2 id="%F0%9F%94%90-secure-coding-practices">üîê Secure Coding Practices</h2>
<h3 id="input-validation-and-sanitization">Input Validation and Sanitization</h3>
<h4 id="1-input-validation-principles">1. <strong>Input Validation Principles</strong></h4>
<ul>
<li><strong>Validate All Inputs</strong>: Check type, length, format, and range</li>
<li><strong>Whitelist Approach</strong>: Allow only known good input</li>
<li><strong>Server-Side Validation</strong>: Never trust client-side validation</li>
<li><strong>Context-Aware Validation</strong>: Validate based on intended use</li>
</ul>
<h4 id="2-input-validation-examples">2. <strong>Input Validation Examples</strong></h4>
<pre class="hljs"><code><div><span class="hljs-comment"># Python input validation example</span>
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Optional

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">validate_email</span><span class="hljs-params">(email: str)</span> -&gt; Optional[str]:</span>
    <span class="hljs-string">"""Validate email format and return sanitized version."""</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> email:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
    
    <span class="hljs-comment"># Email regex pattern</span>
    pattern = <span class="hljs-string">r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'</span>
    
    <span class="hljs-keyword">if</span> re.match(pattern, email):
        <span class="hljs-comment"># Sanitize by removing potentially dangerous characters</span>
        sanitized = re.sub(<span class="hljs-string">r'[&lt;&gt;"\']'</span>, <span class="hljs-string">''</span>, email)
        <span class="hljs-keyword">return</span> sanitized.lower()
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">validate_username</span><span class="hljs-params">(username: str)</span> -&gt; Optional[str]:</span>
    <span class="hljs-string">"""Validate username format."""</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> username:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
    
    <span class="hljs-comment"># Username requirements: 3-20 characters, alphanumeric and underscore</span>
    <span class="hljs-keyword">if</span> re.match(<span class="hljs-string">r'^[a-zA-Z0-9_]{3,20}$'</span>, username):
        <span class="hljs-keyword">return</span> username.lower()
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
</div></code></pre>
<h4 id="3-sql-injection-prevention">3. <strong>SQL Injection Prevention</strong></h4>
<pre class="hljs"><code><div><span class="hljs-comment"># Secure database operations</span>
<span class="hljs-keyword">import</span> sqlite3
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> List, Optional

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserRepository</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, db_path: str)</span>:</span>
        self.db_path = db_path
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_user_by_id</span><span class="hljs-params">(self, user_id: int)</span> -&gt; Optional[dict]:</span>
        <span class="hljs-string">"""Get user by ID using parameterized query."""</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">with</span> sqlite3.connect(self.db_path) <span class="hljs-keyword">as</span> conn:
                cursor = conn.cursor()
                cursor.execute(
                    <span class="hljs-string">"SELECT id, username, email FROM users WHERE id = ?"</span>,
                    (user_id,)
                )
                row = cursor.fetchone()
                
                <span class="hljs-keyword">if</span> row:
                    <span class="hljs-keyword">return</span> {
                        <span class="hljs-string">'id'</span>: row[<span class="hljs-number">0</span>],
                        <span class="hljs-string">'username'</span>: row[<span class="hljs-number">1</span>],
                        <span class="hljs-string">'email'</span>: row[<span class="hljs-number">2</span>]
                    }
                <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
                
        <span class="hljs-keyword">except</span> sqlite3.Error <span class="hljs-keyword">as</span> e:
            <span class="hljs-comment"># Log error securely (no sensitive data)</span>
            logger.error(<span class="hljs-string">f"Database error: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_user</span><span class="hljs-params">(self, username: str, email: str)</span> -&gt; bool:</span>
        <span class="hljs-string">"""Create new user with validation."""</span>
        <span class="hljs-comment"># Validate inputs</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> validate_username(username) <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> validate_email(email):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">with</span> sqlite3.connect(self.db_path) <span class="hljs-keyword">as</span> conn:
                cursor = conn.cursor()
                cursor.execute(
                    <span class="hljs-string">"INSERT INTO users (username, email) VALUES (?, ?)"</span>,
                    (username, email)
                )
                conn.commit()
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
                
        <span class="hljs-keyword">except</span> sqlite3.Error <span class="hljs-keyword">as</span> e:
            logger.error(<span class="hljs-string">f"Database error: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
</div></code></pre>
<h3 id="output-encoding-and-xss-prevention">Output Encoding and XSS Prevention</h3>
<h4 id="1-xss-prevention-strategies">1. <strong>XSS Prevention Strategies</strong></h4>
<ul>
<li><strong>Output Encoding</strong>: Encode all dynamic content</li>
<li><strong>Content Security Policy</strong>: Restrict script execution</li>
<li><strong>Input Sanitization</strong>: Remove dangerous HTML/JavaScript</li>
<li><strong>HttpOnly Cookies</strong>: Prevent XSS cookie theft</li>
</ul>
<h4 id="2-output-encoding-examples">2. <strong>Output Encoding Examples</strong></h4>
<pre class="hljs"><code><div><span class="hljs-comment"># HTML output encoding</span>
<span class="hljs-keyword">import</span> html

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">safe_html_output</span><span class="hljs-params">(user_input: str)</span> -&gt; str:</span>
    <span class="hljs-string">"""Safely output user input in HTML context."""</span>
    <span class="hljs-keyword">return</span> html.escape(user_input)

<span class="hljs-comment"># JavaScript output encoding</span>
<span class="hljs-keyword">import</span> json

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">safe_js_output</span><span class="hljs-params">(user_input: str)</span> -&gt; str:</span>
    <span class="hljs-string">"""Safely output user input in JavaScript context."""</span>
    <span class="hljs-keyword">return</span> json.dumps(user_input)

<span class="hljs-comment"># URL output encoding</span>
<span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> quote

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">safe_url_output</span><span class="hljs-params">(user_input: str)</span> -&gt; str:</span>
    <span class="hljs-string">"""Safely output user input in URL context."""</span>
    <span class="hljs-keyword">return</span> quote(user_input)
</div></code></pre>
<h4 id="3-content-security-policy">3. <strong>Content Security Policy</strong></h4>
<pre class="hljs"><code><div><span class="hljs-comment">&lt;!-- HTML CSP header --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"Content-Security-Policy"</span> 
      <span class="hljs-attr">content</span>=<span class="hljs-string">"default-src 'self'; 
               script-src 'self' 'unsafe-inline'; 
               style-src 'self' 'unsafe-inline'; 
               img-src 'self' data: https:;"</span>&gt;</span>

<span class="hljs-comment">&lt;!-- HTTP Response Header --&gt;</span>
Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline'
</div></code></pre>
<h2 id="%F0%9F%94%91-authentication-and-session-management">üîë Authentication and Session Management</h2>
<h3 id="secure-authentication-implementation">Secure Authentication Implementation</h3>
<h4 id="1-password-security">1. <strong>Password Security</strong></h4>
<pre class="hljs"><code><div><span class="hljs-comment"># Secure password hashing</span>
<span class="hljs-keyword">import</span> bcrypt
<span class="hljs-keyword">import</span> secrets

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hash_password</span><span class="hljs-params">(password: str)</span> -&gt; str:</span>
    <span class="hljs-string">"""Hash password using bcrypt."""</span>
    <span class="hljs-comment"># Generate salt and hash</span>
    salt = bcrypt.gensalt(rounds=<span class="hljs-number">12</span>)
    hashed = bcrypt.hashpw(password.encode(<span class="hljs-string">'utf-8'</span>), salt)
    <span class="hljs-keyword">return</span> hashed.decode(<span class="hljs-string">'utf-8'</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">verify_password</span><span class="hljs-params">(password: str, hashed: str)</span> -&gt; bool:</span>
    <span class="hljs-string">"""Verify password against hash."""</span>
    <span class="hljs-keyword">return</span> bcrypt.checkpw(password.encode(<span class="hljs-string">'utf-8'</span>), hashed.encode(<span class="hljs-string">'utf-8'</span>))

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">generate_secure_token</span><span class="hljs-params">()</span> -&gt; str:</span>
    <span class="hljs-string">"""Generate cryptographically secure token."""</span>
    <span class="hljs-keyword">return</span> secrets.token_urlsafe(<span class="hljs-number">32</span>)
</div></code></pre>
<h4 id="2-multi-factor-authentication">2. <strong>Multi-Factor Authentication</strong></h4>
<pre class="hljs"><code><div><span class="hljs-comment"># MFA implementation example</span>
<span class="hljs-keyword">import</span> pyotp
<span class="hljs-keyword">import</span> qrcode

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MFAService</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
        self.secret_key = pyotp.random_base32()
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">generate_qr_code</span><span class="hljs-params">(self, username: str)</span> -&gt; str:</span>
        <span class="hljs-string">"""Generate QR code for TOTP setup."""</span>
        totp = pyotp.TOTP(self.secret_key)
        provisioning_uri = totp.provisioning_uri(
            name=username,
            issuer_name=<span class="hljs-string">"MyApp"</span>
        )
        <span class="hljs-keyword">return</span> provisioning_uri
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">verify_totp</span><span class="hljs-params">(self, token: str)</span> -&gt; bool:</span>
        <span class="hljs-string">"""Verify TOTP token."""</span>
        totp = pyotp.TOTP(self.secret_key)
        <span class="hljs-keyword">return</span> totp.verify(token)
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_current_totp</span><span class="hljs-params">(self)</span> -&gt; str:</span>
        <span class="hljs-string">"""Get current TOTP value."""</span>
        totp = pyotp.TOTP(self.secret_key)
        <span class="hljs-keyword">return</span> totp.now()
</div></code></pre>
<h3 id="session-management-security">Session Management Security</h3>
<h4 id="1-secure-session-implementation">1. <strong>Secure Session Implementation</strong></h4>
<pre class="hljs"><code><div><span class="hljs-comment"># Flask session management example</span>
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, session, request
<span class="hljs-keyword">from</span> flask_session <span class="hljs-keyword">import</span> Session
<span class="hljs-keyword">import</span> secrets

app = Flask(__name__)

<span class="hljs-comment"># Secure session configuration</span>
app.config.update(
    SECRET_KEY=secrets.token_hex(<span class="hljs-number">32</span>),
    SESSION_TYPE=<span class="hljs-string">'filesystem'</span>,
    SESSION_FILE_DIR=<span class="hljs-string">'/tmp/flask_session'</span>,
    SESSION_COOKIE_SECURE=<span class="hljs-literal">True</span>,
    SESSION_COOKIE_HTTPONLY=<span class="hljs-literal">True</span>,
    SESSION_COOKIE_SAMESITE=<span class="hljs-string">'Lax'</span>,
    PERMANENT_SESSION_LIFETIME=timedelta(hours=<span class="hljs-number">2</span>)
)

Session(app)

<span class="hljs-meta">@app.before_request</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">before_request</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-string">"""Security checks before each request."""</span>
    <span class="hljs-comment"># Regenerate session ID on login</span>
    <span class="hljs-keyword">if</span> <span class="hljs-string">'user_id'</span> <span class="hljs-keyword">in</span> session <span class="hljs-keyword">and</span> <span class="hljs-string">'session_regenerated'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> session:
        session.regenerate()
        session[<span class="hljs-string">'session_regenerated'</span>] = <span class="hljs-literal">True</span>
    
    <span class="hljs-comment"># Check session timeout</span>
    <span class="hljs-keyword">if</span> <span class="hljs-string">'last_activity'</span> <span class="hljs-keyword">in</span> session:
        <span class="hljs-keyword">if</span> datetime.utcnow() - session[<span class="hljs-string">'last_activity'</span>] &gt; timedelta(hours=<span class="hljs-number">2</span>):
            session.clear()
            <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">'login'</span>))
    
    session[<span class="hljs-string">'last_activity'</span>] = datetime.utcnow()

<span class="hljs-meta">@app.route('/login', methods=['POST'])</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">login</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-string">"""Secure login endpoint."""</span>
    username = request.form.get(<span class="hljs-string">'username'</span>)
    password = request.form.get(<span class="hljs-string">'password'</span>)
    
    <span class="hljs-keyword">if</span> verify_credentials(username, password):
        <span class="hljs-comment"># Clear any existing session</span>
        session.clear()
        
        <span class="hljs-comment"># Set new session data</span>
        session[<span class="hljs-string">'user_id'</span>] = get_user_id(username)
        session[<span class="hljs-string">'username'</span>] = username
        session[<span class="hljs-string">'login_time'</span>] = datetime.utcnow().isoformat()
        
        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">'dashboard'</span>))
    
    <span class="hljs-keyword">return</span> <span class="hljs-string">'Invalid credentials'</span>, <span class="hljs-number">401</span>
</div></code></pre>
<h4 id="2-session-security-best-practices">2. <strong>Session Security Best Practices</strong></h4>
<ul>
<li><strong>Secure Cookies</strong>: Use HttpOnly, Secure, and SameSite flags</li>
<li><strong>Session Timeout</strong>: Implement automatic session expiration</li>
<li><strong>Session Regeneration</strong>: Change session ID after login</li>
<li><strong>Concurrent Session Control</strong>: Limit active sessions per user</li>
<li><strong>Session Invalidation</strong>: Proper logout and session cleanup</li>
</ul>
<h2 id="%F0%9F%8C%90-api-security">üåê API Security</h2>
<h3 id="api-security-principles">API Security Principles</h3>
<h4 id="1-authentication-and-authorization">1. <strong>Authentication and Authorization</strong></h4>
<pre class="hljs"><code><div><span class="hljs-comment"># JWT-based API authentication</span>
<span class="hljs-keyword">import</span> jwt
<span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> wraps
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> request, jsonify

SECRET_KEY = <span class="hljs-string">'your-secret-key'</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">generate_token</span><span class="hljs-params">(user_id: int, username: str)</span> -&gt; str:</span>
    <span class="hljs-string">"""Generate JWT token."""</span>
    payload = {
        <span class="hljs-string">'user_id'</span>: user_id,
        <span class="hljs-string">'username'</span>: username,
        <span class="hljs-string">'exp'</span>: datetime.utcnow() + timedelta(hours=<span class="hljs-number">24</span>)
    }
    <span class="hljs-keyword">return</span> jwt.encode(payload, SECRET_KEY, algorithm=<span class="hljs-string">'HS256'</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">verify_token</span><span class="hljs-params">(token: str)</span> -&gt; dict:</span>
    <span class="hljs-string">"""Verify JWT token."""</span>
    <span class="hljs-keyword">try</span>:
        payload = jwt.decode(token, SECRET_KEY, algorithms=[<span class="hljs-string">'HS256'</span>])
        <span class="hljs-keyword">return</span> payload
    <span class="hljs-keyword">except</span> jwt.ExpiredSignatureError:
        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">'Token expired'</span>)
    <span class="hljs-keyword">except</span> jwt.InvalidTokenError:
        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">'Invalid token'</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">require_auth</span><span class="hljs-params">(f)</span>:</span>
    <span class="hljs-string">"""Decorator to require authentication."""</span>
<span class="hljs-meta">    @wraps(f)</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decorated</span><span class="hljs-params">(*args, **kwargs)</span>:</span>
        token = request.headers.get(<span class="hljs-string">'Authorization'</span>)
        
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> token:
            <span class="hljs-keyword">return</span> jsonify({<span class="hljs-string">'message'</span>: <span class="hljs-string">'Missing token'</span>}), <span class="hljs-number">401</span>
        
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># Remove 'Bearer ' prefix</span>
            <span class="hljs-keyword">if</span> token.startswith(<span class="hljs-string">'Bearer '</span>):
                token = token[<span class="hljs-number">7</span>:]
            
            payload = verify_token(token)
            request.user = payload
            <span class="hljs-keyword">return</span> f(*args, **kwargs)
            
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-keyword">return</span> jsonify({<span class="hljs-string">'message'</span>: str(e)}), <span class="hljs-number">401</span>
    
    <span class="hljs-keyword">return</span> decorated

<span class="hljs-meta">@app.route('/api/protected', methods=['GET'])</span>
<span class="hljs-meta">@require_auth</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">protected_endpoint</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-string">"""Protected API endpoint."""</span>
    user = request.user
    <span class="hljs-keyword">return</span> jsonify({
        <span class="hljs-string">'message'</span>: <span class="hljs-string">'Access granted'</span>,
        <span class="hljs-string">'user_id'</span>: user[<span class="hljs-string">'user_id'</span>],
        <span class="hljs-string">'username'</span>: user[<span class="hljs-string">'username'</span>]
    })
</div></code></pre>
<h4 id="2-rate-limiting">2. <strong>Rate Limiting</strong></h4>
<pre class="hljs"><code><div><span class="hljs-comment"># API rate limiting implementation</span>
<span class="hljs-keyword">from</span> flask_limiter <span class="hljs-keyword">import</span> Limiter
<span class="hljs-keyword">from</span> flask_limiter.util <span class="hljs-keyword">import</span> get_remote_address

limiter = Limiter(
    app,
    key_func=get_remote_address,
    default_limits=[<span class="hljs-string">"200 per day"</span>, <span class="hljs-string">"50 per hour"</span>]
)

<span class="hljs-meta">@app.route('/api/login', methods=['POST'])</span>
<span class="hljs-meta">@limiter.limit("5 per minute")</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">api_login</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-string">"""Rate-limited login endpoint."""</span>
    <span class="hljs-comment"># Login logic here</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-meta">@app.route('/api/data', methods=['GET'])</span>
<span class="hljs-meta">@limiter.limit("100 per hour")</span>
<span class="hljs-meta">@require_auth</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_data</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-string">"""Rate-limited data endpoint."""</span>
    <span class="hljs-comment"># Data retrieval logic here</span>
    <span class="hljs-keyword">pass</span>
</div></code></pre>
<h4 id="3-input-validation-for-apis">3. <strong>Input Validation for APIs</strong></h4>
<pre class="hljs"><code><div><span class="hljs-comment"># API input validation with marshmallow</span>
<span class="hljs-keyword">from</span> marshmallow <span class="hljs-keyword">import</span> Schema, fields, validate

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserSchema</span><span class="hljs-params">(Schema)</span>:</span>
    username = fields.Str(required=<span class="hljs-literal">True</span>, validate=validate.Length(min=<span class="hljs-number">3</span>, max=<span class="hljs-number">20</span>))
    email = fields.Email(required=<span class="hljs-literal">True</span>)
    age = fields.Int(validate=validate.Range(min=<span class="hljs-number">13</span>, max=<span class="hljs-number">120</span>))

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserAPI</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
        self.schema = UserSchema()
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_user</span><span class="hljs-params">(self, data)</span>:</span>
        <span class="hljs-string">"""Create user with validation."""</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># Validate input data</span>
            validated_data = self.schema.load(data)
            
            <span class="hljs-comment"># Process validated data</span>
            <span class="hljs-keyword">return</span> self.process_user_creation(validated_data)
            
        <span class="hljs-keyword">except</span> ValidationError <span class="hljs-keyword">as</span> e:
            <span class="hljs-keyword">return</span> {<span class="hljs-string">'errors'</span>: e.messages}, <span class="hljs-number">400</span>
</div></code></pre>
<h2 id="%F0%9F%A7%AA-security-testing-in-cicd">üß™ Security Testing in CI/CD</h2>
<h3 id="integrating-security-testing">Integrating Security Testing</h3>
<h4 id="1-automated-security-pipeline">1. <strong>Automated Security Pipeline</strong></h4>
<pre class="hljs"><code><div><span class="hljs-comment"># GitHub Actions security pipeline</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">Security</span> <span class="hljs-string">Pipeline</span>
<span class="hljs-attr">on:</span> <span class="hljs-string">[push,</span> <span class="hljs-string">pull_request]</span>

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">security-scan:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v2</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">SAST</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">github/codeql-action/init@v2</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">languages:</span> <span class="hljs-string">python,</span> <span class="hljs-string">javascript</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Perform</span> <span class="hljs-string">CodeQL</span> <span class="hljs-string">Analysis</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">github/codeql-action/analyze@v2</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">dependency</span> <span class="hljs-string">scan</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          pip install safety
          safety check --json --output safety-report.json
</span>      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">OWASP</span> <span class="hljs-string">ZAP</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          # Start application
          npm start &amp;
</span>          
          <span class="hljs-comment"># Wait for app to start</span>
          <span class="hljs-string">sleep</span> <span class="hljs-number">30</span>
          
          <span class="hljs-comment"># Run ZAP scan</span>
          <span class="hljs-string">zap-baseline.py</span> <span class="hljs-string">-t</span> <span class="hljs-string">http://localhost:3000</span> <span class="hljs-string">-J</span> <span class="hljs-string">zap-report.json</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Upload</span> <span class="hljs-string">security</span> <span class="hljs-string">reports</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/upload-artifact@v2</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">name:</span> <span class="hljs-string">security-reports</span>
          <span class="hljs-attr">path:</span> <span class="hljs-string">|
            codeql-report.sarif
            safety-report.json
            zap-report.json
</span></div></code></pre>
<h4 id="2-security-gates">2. <strong>Security Gates</strong></h4>
<pre class="hljs"><code><div><span class="hljs-comment"># Security quality gates</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Check</span> <span class="hljs-string">security</span> <span class="hljs-string">thresholds</span>
  <span class="hljs-attr">run:</span> <span class="hljs-string">|
    # Parse security reports
    python parse_security_reports.py
</span>    
    <span class="hljs-comment"># Check if vulnerabilities exceed thresholds</span>
    <span class="hljs-string">if</span> <span class="hljs-string">[</span> <span class="hljs-string">$CRITICAL_VULNS</span> <span class="hljs-string">-gt</span> <span class="hljs-number">0</span> <span class="hljs-string">];</span> <span class="hljs-string">then</span>
      <span class="hljs-string">echo</span> <span class="hljs-string">"Critical vulnerabilities found. Build failed."</span>
      <span class="hljs-string">exit</span> <span class="hljs-number">1</span>
    <span class="hljs-string">fi</span>
    
    <span class="hljs-string">if</span> <span class="hljs-string">[</span> <span class="hljs-string">$HIGH_VULNS</span> <span class="hljs-string">-gt</span> <span class="hljs-number">5</span> <span class="hljs-string">];</span> <span class="hljs-string">then</span>
      <span class="hljs-string">echo</span> <span class="hljs-string">"Too many high vulnerabilities. Build failed."</span>
      <span class="hljs-string">exit</span> <span class="hljs-number">1</span>
    <span class="hljs-string">fi</span>
    
    <span class="hljs-string">echo</span> <span class="hljs-string">"Security checks passed."</span>
</div></code></pre>
<h3 id="security-testing-tools-integration">Security Testing Tools Integration</h3>
<h4 id="1-sast-tools">1. <strong>SAST Tools</strong></h4>
<ul>
<li><strong>SonarQube</strong>: Quality gates and security rules</li>
<li><strong>CodeQL</strong>: GitHub's semantic code analysis</li>
<li><strong>Semgrep</strong>: Fast, lightweight static analysis</li>
<li><strong>Bandit</strong>: Python security linter</li>
</ul>
<h4 id="2-dast-tools">2. <strong>DAST Tools</strong></h4>
<ul>
<li><strong>OWASP ZAP</strong>: Automated web application scanning</li>
<li><strong>Burp Suite</strong>: Professional security testing</li>
<li><strong>Acunetix</strong>: Comprehensive vulnerability scanning</li>
</ul>
<h4 id="3-dependency-scanning">3. <strong>Dependency Scanning</strong></h4>
<ul>
<li><strong>Snyk</strong>: Vulnerability scanning for dependencies</li>
<li><strong>Safety</strong>: Python dependency security checker</li>
<li><strong>npm audit</strong>: Node.js security auditing</li>
<li><strong>OWASP Dependency Check</strong>: Multi-language dependency scanner</li>
</ul>
<h2 id="%F0%9F%93%8B-security-code-review">üìã Security Code Review</h2>
<h3 id="code-review-checklist">Code Review Checklist</h3>
<h4 id="1-authentication-and-authorization">1. <strong>Authentication and Authorization</strong></h4>
<ul>
<li><input type="checkbox" id="checkbox0"><label for="checkbox0"></label><strong>Input Validation</strong>: All inputs are properly validated</li>
<li><input type="checkbox" id="checkbox1"><label for="checkbox1"></label><strong>Authentication</strong>: Secure authentication mechanisms</li>
<li><input type="checkbox" id="checkbox2"><label for="checkbox2"></label><strong>Authorization</strong>: Proper access control checks</li>
<li><input type="checkbox" id="checkbox3"><label for="checkbox3"></label><strong>Session Management</strong>: Secure session handling</li>
<li><input type="checkbox" id="checkbox4"><label for="checkbox4"></label><strong>Password Security</strong>: Strong password policies</li>
</ul>
<h4 id="2-data-protection">2. <strong>Data Protection</strong></h4>
<ul>
<li><input type="checkbox" id="checkbox5"><label for="checkbox5"></label><strong>Encryption</strong>: Sensitive data is encrypted</li>
<li><input type="checkbox" id="checkbox6"><label for="checkbox6"></label><strong>Data Handling</strong>: Secure data processing and storage</li>
<li><input type="checkbox" id="checkbox7"><label for="checkbox7"></label><strong>Error Handling</strong>: No sensitive information in error messages</li>
<li><input type="checkbox" id="checkbox8"><label for="checkbox8"></label><strong>Logging</strong>: Secure logging practices</li>
<li><input type="checkbox" id="checkbox9"><label for="checkbox9"></label><strong>Data Disposal</strong>: Proper data cleanup</li>
</ul>
<h4 id="3-injection-prevention">3. <strong>Injection Prevention</strong></h4>
<ul>
<li><input type="checkbox" id="checkbox10"><label for="checkbox10"></label><strong>SQL Injection</strong>: Parameterized queries used</li>
<li><input type="checkbox" id="checkbox11"><label for="checkbox11"></label><strong>XSS Prevention</strong>: Output encoding implemented</li>
<li><input type="checkbox" id="checkbox12"><label for="checkbox12"></label><strong>Command Injection</strong>: No shell command execution</li>
<li><input type="checkbox" id="checkbox13"><label for="checkbox13"></label><strong>LDAP Injection</strong>: Secure directory queries</li>
<li><input type="checkbox" id="checkbox14"><label for="checkbox14"></label><strong>NoSQL Injection</strong>: Secure document queries</li>
</ul>
<h4 id="4-configuration-security">4. <strong>Configuration Security</strong></h4>
<ul>
<li><input type="checkbox" id="checkbox15"><label for="checkbox15"></label><strong>Default Settings</strong>: Secure default configurations</li>
<li><input type="checkbox" id="checkbox16"><label for="checkbox16"></label><strong>Environment Variables</strong>: Secure configuration management</li>
<li><input type="checkbox" id="checkbox17"><label for="checkbox17"></label><strong>Secrets Management</strong>: Secure handling of secrets</li>
<li><input type="checkbox" id="checkbox18"><label for="checkbox18"></label><strong>HTTPS</strong>: Secure communication protocols</li>
<li><input type="checkbox" id="checkbox19"><label for="checkbox19"></label><strong>Security Headers</strong>: Proper security headers configured</li>
</ul>
<h3 id="code-review-process">Code Review Process</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TD
    A[Code Review Process] --> B[Automated Checks]
    A --> C[Manual Review]
    A --> D[Security Focus]
    A --> E[Approval Process]
    
    B --> B1[Static analysis]
    B --> B2[Linting]
    B --> B3[Security scanning]
    
    C --> C1[Peer review]
    C --> C2[Security expert review]
    C --> C3[Architecture review]
    
    D --> D1[Vulnerability check]
    D --> D2[Security best practices]
    D --> D3[Threat analysis]
    
    E --> E1[Security approval]
    E --> E2[Quality approval]
    E --> E3[Merge approval]
    
    style A fill:#e3f2fd
    style B fill:#f3e5f5
    style C fill:#e8f5e8
    style D fill:#fff3e0
    style E fill:#fce4ec
</div></code></pre>
<h2 id="%F0%9F%A7%AA-hands-on-activities">üß™ Hands-on Activities</h2>
<h3 id="activity-1-owasp-top-10-analysis">Activity 1: OWASP Top 10 Analysis</h3>
<p><strong>Objective</strong>: Analyze and understand OWASP Top 10 vulnerabilities.</p>
<p><strong>Scenario</strong>: Review a vulnerable web application for security issues.</p>
<p><strong>Steps</strong>:</p>
<ol>
<li><strong>Vulnerability Identification</strong>: Find examples of each OWASP Top 10 category</li>
<li><strong>Risk Assessment</strong>: Evaluate the severity and impact of each vulnerability</li>
<li><strong>Mitigation Planning</strong>: Develop remediation strategies for each finding</li>
<li><strong>Documentation</strong>: Create a comprehensive security assessment report</li>
</ol>
<h3 id="activity-2-secure-code-implementation">Activity 2: Secure Code Implementation</h3>
<p><strong>Objective</strong>: Implement secure coding practices in a sample application.</p>
<p><strong>Materials</strong>: Development environment, sample vulnerable code</p>
<p><strong>Steps</strong>:</p>
<ol>
<li><strong>Code Review</strong>: Identify security vulnerabilities in sample code</li>
<li><strong>Secure Implementation</strong>: Rewrite vulnerable code with security best practices</li>
<li><strong>Testing</strong>: Verify that security vulnerabilities are mitigated</li>
<li><strong>Documentation</strong>: Document security improvements and lessons learned</li>
</ol>
<h3 id="activity-3-security-testing-integration">Activity 3: Security Testing Integration</h3>
<p><strong>Objective</strong>: Integrate security testing tools into a CI/CD pipeline.</p>
<p><strong>Materials</strong>: CI/CD platform, security testing tools</p>
<p><strong>Steps</strong>:</p>
<ol>
<li><strong>Tool Selection</strong>: Choose appropriate SAST and DAST tools</li>
<li><strong>Pipeline Configuration</strong>: Configure security testing in CI/CD</li>
<li><strong>Quality Gates</strong>: Implement security thresholds and gates</li>
<li><strong>Monitoring</strong>: Set up security testing monitoring and reporting</li>
</ol>
<h3 id="activity-4-api-security-assessment">Activity 4: API Security Assessment</h3>
<p><strong>Objective</strong>: Assess and secure a REST API application.</p>
<p><strong>Scenario</strong>: Security review of a company's public API.</p>
<p><strong>Steps</strong>:</p>
<ol>
<li><strong>API Mapping</strong>: Identify all API endpoints and functionality</li>
<li><strong>Security Testing</strong>: Test for common API vulnerabilities</li>
<li><strong>Authentication Review</strong>: Assess authentication and authorization mechanisms</li>
<li><strong>Security Hardening</strong>: Implement security improvements</li>
<li><strong>Documentation</strong>: Create API security guidelines and best practices</li>
</ol>
<h2 id="%F0%9F%93%8B-key-takeaways">üìã Key Takeaways</h2>
<ol>
<li>
<p><strong>Application security</strong> is essential for protecting software from various threats and vulnerabilities.</p>
</li>
<li>
<p><strong>Secure SDLC</strong> integrates security practices throughout the development lifecycle.</p>
</li>
<li>
<p><strong>OWASP Top 10</strong> identifies the most critical web application security risks.</p>
</li>
<li>
<p><strong>Security testing</strong> includes SAST, DAST, and IAST approaches for comprehensive coverage.</p>
</li>
<li>
<p><strong>Secure coding practices</strong> prevent common vulnerabilities like injection and XSS attacks.</p>
</li>
<li>
<p><strong>Authentication and session management</strong> are critical for maintaining application security.</p>
</li>
<li>
<p><strong>API security</strong> requires special attention to authentication, authorization, and input validation.</p>
</li>
<li>
<p><strong>CI/CD integration</strong> ensures security testing is automated and consistent.</p>
</li>
</ol>
<h2 id="%E2%9D%93-review-questions">‚ùì Review Questions</h2>
<ol>
<li>
<p><strong>What are the key phases</strong> of the Secure Software Development Lifecycle?</p>
</li>
<li>
<p><strong>How can you prevent</strong> SQL injection and XSS vulnerabilities in web applications?</p>
</li>
<li>
<p><strong>What tools and techniques</strong> are used for SAST and DAST security testing?</p>
</li>
<li>
<p><strong>How should authentication</strong> and session management be implemented securely?</p>
</li>
<li>
<p><strong>What are the main considerations</strong> for securing REST APIs?</p>
</li>
</ol>
<h2 id="%F0%9F%93%9A-further-reading">üìö Further Reading</h2>
<h3 id="books">Books</h3>
<ul>
<li>&quot;The Web Application Hacker's Handbook&quot; by Dafydd Stuttard and Marcus Pinto</li>
<li>&quot;Secure Coding: Principles and Practices&quot; by Mark G. Graff and Kenneth R. van Wyk</li>
<li>&quot;Building Secure Software&quot; by John Viega and Gary McGraw</li>
</ul>
<h3 id="online-resources">Online Resources</h3>
<ul>
<li><a href="https://owasp.org/Top10/">OWASP Top 10</a></li>
<li><a href="https://owasp.org/www-project-secure-coding-practices-quick-reference-guide/">OWASP Secure Coding Practices</a></li>
<li><a href="https://owasp.org/www-project-application-security-verification-standard/">OWASP Application Security Verification Standard</a></li>
</ul>
<h3 id="tools-and-platforms">Tools and Platforms</h3>
<ul>
<li><a href="https://owasp.org/www-project-zap/">OWASP ZAP</a> - Web application security scanner</li>
<li><a href="https://www.sonarqube.org/">SonarQube</a> - Code quality and security platform</li>
<li><a href="https://semgrep.dev/">Semgrep</a> - Static analysis tool</li>
</ul>
<hr>
<p><strong>Next Chapter</strong>: <a href="chapter11-project-management.md">Chapter 11: IT Project Management</a> - Learn about project management frameworks, Agile methodologies, and risk management in IT projects.</p>

</body>
</html>
